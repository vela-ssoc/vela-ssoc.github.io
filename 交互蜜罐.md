# 交互蜜罐
> 内置基础高交互蜜罐系统

## 内置方法
- [chameleon.mysql(cfg)](#mysql蜜罐)&emsp;mysql交互蜜罐
- [chameleon.ssh(cfg)](#ssh蜜罐)&emsp;SSH交互蜜罐
- [chameleon.proxy(cfg)](#代理蜜罐)&emsp;代理交互蜜罐
- [chameleon.stream(cfg)](#stream)&emsp;二级代理交互蜜罐
- [产生的事件为风险事件](/风险事件.md#event)

## mysql蜜罐
> mysql = chameleon.mysql(cfg) &emsp;轻量内置mysql服务器, 支持数据伪造和驱动链接  <br />
> cfg:配置信息 返回: [mysql任务对象](#)

配置信息:
- name 
- bind &emsp;监听地址:0.0.0.0:3306


内置事件类型:
- [honey_mysql_auth](#)
- [honey_mysql_conn](#)
- [honey_mysql_query](#)
- [honey_mysql_raw](#)


```lua
    local mysql = chameleon.mysql{
        name = "mysql",
        bind = "0.0.0.0:3307"
    }

    local auth = mysql.auth("root" , "123456") --设置认证
    local users  = mysql.new_table("users" ,
        { name = "name", type = "text", null = false },
        { name = "mail", type = "text", null = false },
        { name = "age",  type = "int",  null = false },
        { name = "pass", type = "text", null = false })

    users.insert("edunx" , "123@qq.com" , 18 , "123654")
    users.insert("edunx" , "123@qq.com" , 18 , "123654")
    users.insert("edunx" , "123@qq.com" , 18 , "123654")
    users.insert("suncle" , "1@qq.com" , 20 , "123654")

    local infos  = mysql.new_table("infos" , --新建表
        { name = "name", type = "text", null = false },
        { name = "mail", type = "text", null = false },
        { name = "age",  type = "int",  null = false },
        { name = "pass", type = "text", null = false })

    --插入数据
    infos.insert("edunx" , "123@qq.com" , 18 , "123654")
    infos.insert("edunx" , "123@qq.com" , 18 , "123654")
    infos.insert("edunx" , "123@qq.com" , 18 , "123654")
    infos.insert("suncle" , "456@qq.com" , 20 , "123654")

    local rock_db = mysql.new_db("rock_db") --新建database
    rock_db.add_table( users , infos) --添加表结构

    start(mysql.new{
        name = "mysql", 
        bind = "0.0.0.0:3308",
        database = rock_db,
        auth = auth,
    })
```

## ssh蜜罐
> ssh = chameleon.ssh(cfg)轻量内置ssh服务器 <br/>
> cfg:配置参数  返回:[蜜罐对象](#)

配置参数:
- name
- bind
- prompt

```lua
    
    local ssh_s = chameleon.ssh{
        name = "ssh_honey_pot",
        bind = "0.0.0.0:2222",
        prompt = "~$",
    }
    ssh_s.auth_root = "123456" --设置root账户密码
    ssh_s.auth_app = "123456" --新增app账户密码
    start(ssh_s)
```

## 代理蜜罐 
> data = chamemleon.proxy(cfg) 代理型蜜罐 <br />
> cfg:配置参数   返回:[代理对象](#)

配置参数:
- name
- bind &emsp; 本地监听: tcp://0.0.0.0:3310 
- remote &emsp; 后端服务: tcp://0.0.0.0:3306

内置函数:
- ignore(cnd)
- pipe(px)
- start()

```lua
local ud = chameleon.proxy{
    name = "mysql2",
    bind = "tcp://0.0.0.0:3310",     --对外端口
    remote = "tcp://127.0.0.1:3308", --后端地址
}

ud.ignore("src re 192.168.1.*,192.168.2.*")
ud.ignore("src_port = 80,8080")

ud.pipe(function(ev) 
   --vela-audit.vela-event 
end)

ud.start()
```

## stream
> 二级代理 client----->agent----->broker---->remote <br />
> userdata = chameleon.stream(cfg)

配置信息:
- name
- bind &emsp; 本地监听: tcp://0.0.0.0:3310
- remote &emsp; 后端服务: tcp://10.0.0.1:3306

内置方法:
- [userdata.pipe(v , ...)](#)
- [userdata.start()](#)
- [userdata.ignore()](#)



```lua
    local ud = chameleon.stream{
        name = "mysql3",
        bind = "tcp://0.0.0.0:3310",     --对外端口
        remote = "tcp://127.0.0.1:3308", --后端地址
    }

    ud.pipe(function(ev)
        --vela-audit.vela-event 
    end)

    ud.start()
```